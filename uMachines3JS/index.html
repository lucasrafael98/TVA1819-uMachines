<html>
  <head>
    <meta charset="utf-8">
    <title>&mu;Machines | AVT Group 2</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Anton|Audiowide|Kumar+One+Outline|Righteous|Shrikhand|Russo+One" rel="stylesheet">
    <script src="js/three.min.js"></script>
    <script src="js/three.proton.min.js"></script>
    <script src="js/GameElement.js"></script>
    <script src="js/Track.js"></script>
    <script src="js/Orange.js"></script>
    <script src="js/Butter.js"></script>
    <script src="js/Cheerio.js"></script>
    <script src="js/Vehicle.js"></script>
    <script src="js/Car.js"></script>
    <script src="js/Tree.js"></script>
    <script src="js/Ovni.js"></script>
    <script src="js/Sun.js"></script>
    <script src="js/Skybox.js"></script>
    <script src="js/Candle.js"></script>
    <script src="js/Materials.js"></script>
    <script src="js/UI.js"></script>
    <script src="js/Collisions.js"></script>
    <script src="js/CallbackFunctions.js"></script>
    <script src="js/AuxFunctions.js"></script>
    <script src="js/Cameras.js"></script>
    <script src="js/UpdateFunctions.js"></script>
    <script src="js/ParticleFunctions.js"></script>
    <script src="js/IntroFunctions.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/Reflector.js"></script>
    <script src="js/Lensflare.js"></script>
    <script src="js/SceneUtils.js"></script>
    <script src="js/OBJLoader.js"></script>
    <script src="js/MTLLoader.js"></script>
    <script src="js/Main.js"></script>
  </head>
  <body>
  <div id="introMenu">
    <div id="introName">&mu;Machines</div>
    <div id="introCarBox" onmouseover="mouseOver(0)" onmouseleave="mouseLeave(0)" onclick="clicked(0)"></div>
    <div id="introOvniBox" onmouseover="mouseOver(1)" onmouseleave="mouseLeave(1)" onclick="clicked(1)"></div>
    <button id="startButton" onclick="clicked(2)">PLAY</button>
    <button id="changeSkyBoxButton" onclick="clicked(3)">CHANGE VIEW</button>
  </div>
    <script>
      init();
      animate();
    </script>
    <script id="frag_sh" type="x-shader/x-fragment">
      #ifdef GL_ES
      precision highp float;
      #endif
      varying vec3 L;
      varying vec3 V;
      varying vec3 P;
      varying vec2 vUv;

      uniform vec3 lightColor;
      uniform sampler2D baseTexture;
      uniform sampler2D normalMap;

      void main() {
        vec3 lightDir = normalize(L);
        vec3 viewDir = normalize(V);

        vec3 color = texture2D(baseTexture, vUv).rgb;

        vec3 normal = normalize(texture2D(normalMap, vUv).rgb * 2.0 - 1.0);
        
        vec3 halfDir = normalize(lightDir + viewDir);

        float diffuse = max(dot(normal, lightDir), 0.0);
        float spec = pow(max(dot(normal, halfDir), 0.0), 1.0);
        gl_FragColor = vec4(diffuse * color, 0.75); 

      }
    </script>
    <script id="vert_sh" type="x-shader/x-vertex">

      varying vec3 L;
      varying vec3 V;
      varying vec3 P;
      varying vec2 vUv;
    
      uniform vec3 lightPosition;
      uniform vec3 eyePosition;
    
      attribute vec3 tangent;
      attribute vec3 bitangent;


      highp mat3 transpose(in highp mat3 inMatrix) {
        highp vec3 i0 = inMatrix[0];
        highp vec3 i1 = inMatrix[1];
        highp vec3 i2 = inMatrix[2];
    
        highp mat3 outMatrix = mat3(
                     vec3(i0.x, i1.x, i2.x),
                     vec3(i0.y, i1.y, i2.y),
                     vec3(i0.z, i1.z, i2.z)
                     );
    
        return outMatrix;
      }
    
      void main() {
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        P = vec3(modelViewMatrix * vec4(position, 1.0));
        vec3 vert_norm = cross(bitangent, tangent);

        vec3 t = normalize(mat3(normalMatrix) * tangent);
        vec3 b = normalize(mat3(normalMatrix) * bitangent);
        vec3 n = normalize(mat3(normalMatrix) * vert_norm);
  
        mat3 tbn = transpose(mat3( t, b, n ));
    
        vec3 mvPosition = (modelViewMatrix * vec4(position,1.0)).xyz;
  
        L =  tbn *  (lightPosition - mvPosition) ;
  
        V =  tbn *  (eyePosition - mvPosition);

        P = tbn * position;

        vUv = uv;
  
    
    
      }
    </script>
  </body>
</html>
